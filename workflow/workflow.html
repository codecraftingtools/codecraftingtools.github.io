

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Workflow &mdash; Code Craftsmen  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Status" href="../status.html" />
    <link rel="prev" title="Vision" href="../vision.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> Code Craftsmen
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../vision.html">Vision</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Workflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#bottom-up">Bottom-Up</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#define-message-data-structures">Define Message Data Structures</a></li>
<li class="toctree-l3"><a class="reference internal" href="#define-component-messaging-interfaces">Define Component Messaging Interfaces</a></li>
<li class="toctree-l3"><a class="reference internal" href="#declare-primitive-components">Declare Primitive Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implement-primitive-components">Implement Primitive Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#define-composite-components">Define Composite Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#declare-the-application">Declare the Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#arrange-the-source-files">Arrange the Source Files</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-the-application">Build the Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#run-the-application">Run the Application</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#top-down">Top-Down</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#define-the-top-level-components-and-data-flow">Define the Top-Level Components and Data Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#iteratively-define-subcomponents">Iteratively Define Subcomponents</a></li>
<li class="toctree-l3"><a class="reference internal" href="#refine-data-flow">Refine Data Flow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#define-configuration-properties">Define Configuration Properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#declare-and-implement-primitive-components">Declare and Implement Primitive Components</a></li>
<li class="toctree-l3"><a class="reference internal" href="#update-composite-component-definitions">Update Composite Component Definitions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#final-steps">Final Steps</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../status.html">Status</a></li>
<li class="toctree-l1"><a class="reference internal" href="../philosophy.html">Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../guidelines.html">Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../considerations.html">Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../software.html">Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../foundation.html">Foundation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../notes.html">Notes</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Code Craftsmen</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Workflow</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/workflow/workflow.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="workflow">
<h1>Workflow<a class="headerlink" href="#workflow" title="Permalink to this headline">¶</a></h1>
<p>Let us walk through a simple (but complete) example to demonstrate how
our code crafting tools can be leveraged in bottom-up and top-down
software development workflows.</p>
<div class="section" id="bottom-up">
<h2>Bottom-Up<a class="headerlink" href="#bottom-up" title="Permalink to this headline">¶</a></h2>
<p>In a bottom-up workflow, the most fundamental, low-level pieces of
software are implemented first, and then functionality is
progressively added by assembling these pieces into more complex,
higher-level components.</p>
<div class="section" id="define-message-data-structures">
<h3>Define Message Data Structures<a class="headerlink" href="#define-message-data-structures" title="Permalink to this headline">¶</a></h3>
<p>The first step in a bottom-up workflow is to define the data content
and format of each message that is passed between software components
in the application.  This is accomplished by writing suitable data
structure declarations in <a class="reference internal" href="../software.html#tydl"><span class="std std-ref">Tydl</span></a>, our custom type definition
language.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">HVAC/Temperature.td</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import all: from: (Tydl, Tydl.Data.Types)

file namespace: HVAC.Temperature

Measurement: Record
  fields:
    Temperature: Float32
    Humidity: Float32
</pre></div>
</div>
</div>
</div>
<div class="section" id="define-component-messaging-interfaces">
<h3>Define Component Messaging Interfaces<a class="headerlink" href="#define-component-messaging-interfaces" title="Permalink to this headline">¶</a></h3>
<p>The second step is to define the messaging interface for each software
component in the application.  Components have input ports for
receiving messages from other components and output ports for sending
messages to other components.  Each port has a name and an associated
data type that defines the message format.  If no data type is
specified, all messages sent or received on that port are treated as
events with no data content.  Component messaging interfaces are
defined using the <a class="reference internal" href="../software.html#smidgen"><span class="std std-ref">Smidgen</span></a> syntax, which builds on <a class="reference internal" href="../software.html#tydl"><span class="std std-ref">Tydl</span></a>.</p>
<table class="colwidths-given docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">HVAC/Heating/Element.mi</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import all: from: Smidgen

file namespace: HVAC.Heating.Element

Element.IO: Messaging.Interface
  extends: Stateful.IO
  ports:
    Enable:
      input:
    Disable:
      input:
</pre></div>
</div>
</div>
</td>
<td><img alt="../_images/element_mi.svg" src="../_images/element_mi.svg" /></td>
</tr>
</tbody>
</table>
<table class="colwidths-given docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">HVAC/Temperature/Controller.mi</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import all: from: (Smidgen, Smidgen.Data.Types)

file namespace: HVAC.Temperature.Controller

Controller.IO: Messaging.Interface
  extends: Stateful.IO
  ports:
    Measurement:
      input:
      type: Measurement
    Enable:
      output:
    Disable:
      output:    
  properties:
    Setpoint: Float32 default: 65.0
    Hysteresis: Float32 default: 2.0
</pre></div>
</div>
</div>
</td>
<td><img alt="../_images/controller_mi.svg" src="../_images/controller_mi.svg" /></td>
</tr>
</tbody>
</table>
<table class="colwidths-given docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">HVAC/Temperature/Sensor.mi</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import all: from: (Smidgen, Smidgen.Data.Types)

file namespace: HVAC.Temperature.Sensor

Sensor.IO: Messaging.Interface
  extends: Stateful.IO
  ports:
    Measurement:
      output:
      type: Measurement      
  properties:
    Period: Float64 default: 1.0
</pre></div>
</div>
</div>
</td>
<td><img alt="../_images/sensor_mi.svg" src="../_images/sensor_mi.svg" /></td>
</tr>
</tbody>
</table>
<table class="colwidths-given docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 60%" />
<col style="width: 40%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">HVAC/Thermostat.mi</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import all: from: Smidgen

file namespace: HVAC.Thermostat

Thermostat.IO: Messaging.Interface
  extends: Stateful.IO
  ports:
    Enable:
      output:
    Disable:
      output:
</pre></div>
</div>
</div>
</td>
<td><img alt="../_images/thermostat_mi.svg" src="../_images/thermostat_mi.svg" /></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="declare-primitive-components">
<h3>Declare Primitive Components<a class="headerlink" href="#declare-primitive-components" title="Permalink to this headline">¶</a></h3>
<p>After defining the component messaging interfaces, the next step is to
provide declarations for each primitive C++ component that will be
implemented using the <a class="reference internal" href="../software.html#chimps"><span class="std std-ref">Chimps</span></a> framework.  The <code class="docutils literal notranslate"><span class="pre">Chimps</span></code>
namespace is a superset of <a class="reference internal" href="../software.html#smidgen"><span class="std std-ref">Smidgen</span></a> that provides some
additional implementation-specific constructs like
<code class="docutils literal notranslate"><span class="pre">Stateful.Primitive</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">HVAC/Heating/Element.pi</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import all: from: Chimps

file namespace: HVAC.Heating.Element

Element.Impl: Component.Implementation
  extends: Stateful.Primitive
  interface: Element.IO
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">HVAC/Temperature/Controller.pi</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import all: from: Chimps

file namespace: HVAC.Temperature.Controller

Controller.Impl: Component.Implementation
  extends: Stateful.Primitive
  interface: Controller.IO
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">HVAC/Temperature/Sensor.pi</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import all: from: Chimps

file namespace: HVAC.Temperature.Sensor

Sensor.Impl: Component.Implementation
  extends: Stateful.Primitive
  interface: Sensor.IO
  callbacks:
    Measure:
</pre></div>
</div>
</div>
</div>
<div class="section" id="implement-primitive-components">
<h3>Implement Primitive Components<a class="headerlink" href="#implement-primitive-components" title="Permalink to this headline">¶</a></h3>
<p>Primitive C++ components are implemented by supplying header and
source files with class declarations and definitions that conform to
the <a class="reference internal" href="../software.html#chimps"><span class="std std-ref">Chimps</span></a> API.</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">HVAC/Heating/Element.hpp</span><a class="headerlink" href="#id9" title="Permalink to this code">¶</a></div>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;generated/HVAC/Heating/Element/Base.hpp&quot;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">HVAC</span><span class="o">::</span><span class="n">Heating</span><span class="o">::</span><span class="n">Element</span><span class="o">::</span><span class="nl">Impl</span> <span class="p">:</span> <span class="k">public</span> <span class="n">Base</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">Base</span><span class="o">::</span><span class="n">Base</span><span class="p">;</span>

 <span class="k">protected</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">handle</span><span class="p">(</span><span class="n">Enable</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">handle</span><span class="p">(</span><span class="n">Disable</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">HVAC/Heating/Element.cpp</span><a class="headerlink" href="#id10" title="Permalink to this code">¶</a></div>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;Element.hpp&quot;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">HVAC</span><span class="o">::</span><span class="n">Heating</span><span class="o">::</span><span class="n">Element</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">Impl</span><span class="o">::</span><span class="n">handle</span><span class="p">(</span><span class="n">Enable</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">log</span><span class="p">.</span><span class="n">verbose</span><span class="p">(</span><span class="s">&quot;heat enabled&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Impl</span><span class="o">::</span><span class="n">handle</span><span class="p">(</span><span class="n">Disable</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">log</span><span class="p">.</span><span class="n">verbose</span><span class="p">(</span><span class="s">&quot;heat disabled&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">HVAC/Temperature/Controller.hpp</span><a class="headerlink" href="#id11" title="Permalink to this code">¶</a></div>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;generated/HVAC/Temperature/Controller/Base.hpp&quot;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">HVAC</span><span class="o">::</span><span class="n">Temperature</span><span class="o">::</span><span class="n">Controller</span><span class="o">::</span><span class="nl">Impl</span> <span class="p">:</span> <span class="k">public</span> <span class="n">Base</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">Base</span><span class="o">::</span><span class="n">Base</span><span class="p">;</span>

 <span class="k">protected</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">handle</span><span class="p">(</span><span class="n">Initialize</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">handle</span><span class="p">(</span><span class="n">Finalize</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
  
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">handle</span><span class="p">(</span><span class="n">Measurement</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">HVAC/Temperature/Controller.cpp</span><a class="headerlink" href="#id12" title="Permalink to this code">¶</a></div>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;Controller.hpp&quot;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">HVAC</span><span class="o">::</span><span class="n">Temperature</span><span class="o">::</span><span class="n">Controller</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">Impl</span><span class="o">::</span><span class="n">handle</span><span class="p">(</span><span class="n">Initialize</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">send</span><span class="p">(</span><span class="n">Disable</span><span class="p">());</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Impl</span><span class="o">::</span><span class="n">handle</span><span class="p">(</span><span class="n">Finalize</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">send</span><span class="p">(</span><span class="n">Disable</span><span class="p">());</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Impl</span><span class="o">::</span><span class="n">handle</span><span class="p">(</span><span class="n">Measurement</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">Temperature</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">config</span><span class="p">.</span><span class="n">Setpoint</span><span class="p">()</span> <span class="o">+</span> <span class="n">config</span><span class="p">.</span><span class="n">Hysteresis</span><span class="p">()</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">send</span><span class="p">(</span><span class="n">Disable</span><span class="p">());</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">Temperature</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">config</span><span class="p">.</span><span class="n">Setpoint</span><span class="p">()</span> <span class="o">-</span> <span class="n">config</span><span class="p">.</span><span class="n">Hysteresis</span><span class="p">()</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">send</span><span class="p">(</span><span class="n">Enable</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">HVAC/Temperature/Sensor.hpp</span><a class="headerlink" href="#id13" title="Permalink to this code">¶</a></div>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;generated/HVAC/Temperature/Sensor/Base.hpp&quot;</span><span class="cp"></span>

<span class="k">class</span> <span class="nc">HVAC</span><span class="o">::</span><span class="n">Temperature</span><span class="o">::</span><span class="n">Sensor</span><span class="o">::</span><span class="nl">Impl</span> <span class="p">:</span> <span class="k">public</span> <span class="n">Base</span> <span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">Base</span><span class="o">::</span><span class="n">Base</span><span class="p">;</span>

 <span class="k">protected</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">handle</span><span class="p">(</span><span class="n">Reset</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">handle</span><span class="p">(</span><span class="n">Start</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>
  
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">handle</span><span class="p">(</span><span class="n">Measure</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="k">override</span><span class="p">;</span>

  <span class="kt">double</span> <span class="nf">read_hardware</span><span class="p">();</span>
  
  <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">count_</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">HVAC/Temperature/Sensor.cpp</span><a class="headerlink" href="#id14" title="Permalink to this code">¶</a></div>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;Sensor.hpp&quot;</span><span class="cp"></span>

<span class="k">using</span> <span class="k">namespace</span> <span class="n">HVAC</span><span class="o">::</span><span class="n">Temperature</span><span class="o">::</span><span class="n">Sensor</span><span class="p">;</span>
<span class="k">using</span> <span class="k">namespace</span> <span class="n">chimps</span><span class="o">::</span><span class="n">chrono</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">Impl</span><span class="o">::</span><span class="n">handle</span><span class="p">(</span><span class="n">Reset</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">count_</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Impl</span><span class="o">::</span><span class="n">handle</span><span class="p">(</span><span class="n">Start</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">schedule</span><span class="p">(</span><span class="n">Measure</span><span class="p">(),</span> <span class="n">every</span><span class="p">(</span><span class="mf">1.0</span><span class="n">_s</span> <span class="o">*</span> <span class="n">config</span><span class="p">.</span><span class="n">Period</span><span class="p">));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Impl</span><span class="o">::</span><span class="n">handle</span><span class="p">(</span><span class="n">Measure</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">auto</span> <span class="n">temperature</span> <span class="o">=</span> <span class="n">read_hardware</span><span class="p">();</span>
  <span class="n">log</span><span class="p">.</span><span class="n">verbose</span><span class="p">(</span><span class="s">&quot;measured: {:.1f}&quot;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">);</span>
  
  <span class="n">send</span><span class="p">(</span><span class="n">Measurement</span><span class="p">()</span>
       <span class="p">.</span><span class="n">Temperature</span><span class="p">(</span><span class="n">temperature</span><span class="p">)</span>
       <span class="p">.</span><span class="n">Humidity</span><span class="p">(</span><span class="mf">0.60</span><span class="p">)</span>
       <span class="p">);</span>
<span class="p">}</span>

<span class="kt">float</span> <span class="n">Impl</span><span class="o">::</span><span class="n">read_hardware</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">const</span> <span class="kt">double</span> <span class="n">pi</span> <span class="o">=</span> <span class="mf">3.14159</span><span class="p">;</span>

  <span class="n">count_</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
  
  <span class="k">auto</span> <span class="n">t</span> <span class="o">=</span> <span class="n">count_</span> <span class="o">*</span> <span class="n">config</span><span class="p">.</span><span class="n">Period</span><span class="p">;</span> <span class="c1">// s</span>
  <span class="k">auto</span> <span class="n">f</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span> <span class="c1">// Hz</span>
  <span class="k">auto</span> <span class="n">temperature</span> <span class="o">=</span> <span class="mf">60.0</span> <span class="o">+</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="o">*</span><span class="n">f</span><span class="o">*</span><span class="n">t</span><span class="p">);</span>
    
  <span class="k">return</span> <span class="n">temperature</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="define-composite-components">
<h3>Define Composite Components<a class="headerlink" href="#define-composite-components" title="Permalink to this headline">¶</a></h3>
<p>Once the primitive components have been implemented, they can be
combined and connected to form composite components that build on one
another in a hierarchic fashion.  Interconnections and component
hierarchies are specified using <a class="reference internal" href="../software.html#finch"><span class="std std-ref">Finch</span></a>, an extension of
<a class="reference internal" href="../software.html#smidgen"><span class="std std-ref">Smidgen</span></a>.</p>
<table class="colwidths-given docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 57%" />
<col style="width: 43%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">HVAC/Thermostat.hi</span><a class="headerlink" href="#id15" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import all: from: Finch
import Temperature from: HVAC

file namespace: HVAC.Thermostat

Thermostat.Impl: Component.Implementation
  extends: Component.Hierarchy
  interface: Thermostat.IO
  subcomponents:
    Sensor: Temperature.Sensor.Impl
    Controller: Temperature.Controller.Impl
  connections:
    (source: Sensor.Measurement,
     sink: Controller.Measurement)
    (source: Controller.Enable,
     external: Enable)
    (source: Controller.Disable,
     external: Disable)
</pre></div>
</div>
</div>
</td>
<td><img alt="../_images/thermostat_hi.svg" src="../_images/thermostat_hi.svg" /></td>
</tr>
</tbody>
</table>
<table class="colwidths-given docutils align-default" style="width: 100%">
<colgroup>
<col style="width: 57%" />
<col style="width: 43%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">HVAC/Heater.hi</span><a class="headerlink" href="#id16" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import all: from: Finch
import Heating from: HVAC

file namespace: HVAC.Heater

Heater.Impl: Component.Implementation
  extends: Component.Hierarchy
  interface: Stateful.IO
  subcomponents:
    Thermostat: Thermostat.Impl
    Element: Heating.Element.Impl
  connections:
    (source: Thermostat.Enable,
     sink: Element.Enable)
    (source: Thermostat.Disable,
     sink: Element.Disable)
</pre></div>
</div>
</div>
</td>
<td><img alt="../_images/heater_hi.svg" src="../_images/heater_hi.svg" /></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="declare-the-application">
<h3>Declare the Application<a class="headerlink" href="#declare-the-application" title="Permalink to this headline">¶</a></h3>
<p>Configurable hierarchic applications can be automatically generated
from any top-level component that implements the <code class="docutils literal notranslate"><span class="pre">Stateful.IO</span></code>
messaging interface.</p>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">HVAC/Heater.ha</span><a class="headerlink" href="#id17" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import all: from: Chimps

file namespace: HVAC.Heater

Heater.App: Application
  implementation: Heater.Impl
</pre></div>
</div>
</div>
</div>
<div class="section" id="arrange-the-source-files">
<h3>Arrange the Source Files<a class="headerlink" href="#arrange-the-source-files" title="Permalink to this headline">¶</a></h3>
<p>Source files are generally arranged in a directory structure that
reflects the namespace hierarchy:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>HVAC/
├── Heater.ha
├── Heater.hi
├── Heating
│   ├── Element.cpp
│   ├── Element.hpp
│   ├── Element.mi
│   └── Element.pi
├── Temperature
│   ├── Controller.cpp
│   ├── Controller.hpp
│   ├── Controller.mi
│   ├── Controller.pi
│   ├── Sensor.cpp
│   ├── Sensor.hpp
│   ├── Sensor.mi
│   └── Sensor.pi
├── Temperature.td
├── Thermostat.hi
└── Thermostat.mi
</pre></div>
</div>
</div>
<div class="section" id="build-the-application">
<h3>Build the Application<a class="headerlink" href="#build-the-application" title="Permalink to this headline">¶</a></h3>
<p>Finally, our code crafting command-line tool chain can be used to
build an executable program from from the source files in accordance
with the application declaration by issuing the following command in
the parent directory:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>chimps --build=app --all HVAC
</pre></div>
</div>
<p>This command automatically performs all of the intermediate steps
required to build the application, which are broken out below for
instructional purposes:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>chimps --generate=type --entity=HVAC.Temperature.Measurement HVAC
chimps --generate=impl --entity=HVAC.Heating.Element.Impl \
                       --entity=HVAC.Temperature.Controller.Impl \
                       --entity=HVAC.Temperature.Sensor.Impl \
                       --entity=HVAC.Thermostat.Impl \
                       --entity=HVAC.Heater.Impl HVAC
chimps --generate=app  --entity=HVAC.Heater.App HVAC
chimps --compile=type  --entity=HVAC.Temperature.Measurement HVAC
chimps --compile=impl  --entity=HVAC.Heating.Element.Impl \
                       --entity=HVAC.Temperature.Controller.Impl \
                       --entity=HVAC.Temperature.Sensor.Impl \
                       --entity=HVAC.Thermostat.Impl \
                       --entity=HVAC.Heater.Impl HVAC
chimps --compile=app   --entity=HVAC.Heater.App HVAC
</pre></div>
</div>
</div>
<div class="section" id="run-the-application">
<h3>Run the Application<a class="headerlink" href="#run-the-application" title="Permalink to this headline">¶</a></h3>
<p>The resulting program can be executed like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>./Heater Thermostat.Controller.Setpoint=67.0
</pre></div>
</div>
</div>
</div>
<div class="section" id="top-down">
<h2>Top-Down<a class="headerlink" href="#top-down" title="Permalink to this headline">¶</a></h2>
<p>In a top-down workflow, the process starts with defining the
high-level components and generalized data flow.  Development proceeds
by progressively breaking down each component into smaller
subcomponents and defining the data flow in more detail.  The final
step is actually implementing the primitive components.</p>
<div class="section" id="define-the-top-level-components-and-data-flow">
<h3>Define the Top-Level Components and Data Flow<a class="headerlink" href="#define-the-top-level-components-and-data-flow" title="Permalink to this headline">¶</a></h3>
<p>The first step in a top-down workflow is to define the top-level
components and how data flows between them.  The application structure
can be described directly using <a class="reference internal" href="../software.html#smidgen"><span class="std std-ref">Smidgen</span></a> and <a class="reference internal" href="../software.html#finch"><span class="std std-ref">Finch</span></a>, or by creating block diagrams using the <a class="reference internal" href="../software.html#hildegard"><span class="std std-ref">Hildegard</span></a> GUI application.</p>
<a class="reference internal image-reference" href="../_images/hildegard.png"><img alt="../_images/hildegard.png" src="../_images/hildegard.png" style="width: 60%;" /></a>
<p>Note that since we are not dealing with concrete implementations at
this stage in the design process, subcomponents are specified in terms
of their interface (e.g. <code class="docutils literal notranslate"><span class="pre">Thermostat.IO</span></code>) instead of their
implementation (e.g. <code class="docutils literal notranslate"><span class="pre">Thermostat.Impl</span></code>).</p>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">HVAC/Heater.hi</span><a class="headerlink" href="#id18" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import all: from: Finch
import Heating from: HVAC

file namespace: HVAC.Heater

Heater.Impl: Component.Implementation
  extends: Component.Hierarchy
  interface: Stateful.IO
  subcomponents:
<span class="hll">    Thermostat: Thermostat.IO
</span><span class="hll">    Element: Heating.Element.IO
</span>  connections:
    (source: Thermostat.Enable,
     sink: Element.Enable)
    (source: Thermostat.Disable,
     sink: Element.Disable)
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">HVAC/Thermostat.mi</span></code> and <code class="docutils literal notranslate"><span class="pre">HVAC/Heating/Element.mi</span></code> are defined as
shown in the <a class="reference internal" href="#define-component-messaging-interfaces">bottom-up section</a>.</p>
</div>
<div class="section" id="iteratively-define-subcomponents">
<h3>Iteratively Define Subcomponents<a class="headerlink" href="#iteratively-define-subcomponents" title="Permalink to this headline">¶</a></h3>
<p>The second step is to break each component down into smaller
subcomponents and repeat the process until the entire system can be
described in terms of primitive components.  In this example,
<code class="docutils literal notranslate"><span class="pre">Heating.Element</span></code> is implemented as a primitive C++ component, but
<code class="docutils literal notranslate"><span class="pre">Thermostat</span></code> is is composite component consisting of a <code class="docutils literal notranslate"><span class="pre">Sensor</span></code>
and a <code class="docutils literal notranslate"><span class="pre">Controller</span></code>.</p>
<a class="reference internal image-reference" href="../_images/thermostat_hi.svg"><img alt="../_images/thermostat_hi.svg" src="../_images/thermostat_hi.svg" width="60%" /></a>
<p>Once again, note that subcomponents are specified in terms of their
interface (e.g. <code class="docutils literal notranslate"><span class="pre">Sensor.IO</span></code>) instead of their implementation
(e.g. <code class="docutils literal notranslate"><span class="pre">Sensor.Impl</span></code>) at this point.</p>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">HVAC/Thermostat.hi</span><a class="headerlink" href="#id19" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import all: from: Finch
import Temperature from: HVAC

file namespace: HVAC.Thermostat

Thermostat.Impl: Component.Implementation
  extends: Component.Hierarchy
  interface: Thermostat.IO
  subcomponents:
<span class="hll">    Sensor: Temperature.Sensor.IO
</span><span class="hll">    Controller: Temperature.Controller.IO
</span>  connections:
    (source: Sensor.Measurement,
     sink: Controller.Measurement)
    (source: Controller.Enable,
     external: Enable)
    (source: Controller.Disable,
     external: Disable)
</pre></div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">HVAC/Temperature/Sensor.mi</span></code> and <code class="docutils literal notranslate"><span class="pre">HVAC/Temperature/Controller.mi</span></code>
are similar to what was shown in the <a class="reference internal" href="#define-component-messaging-interfaces">bottom-up section</a>.  The only differences are that the
configuration properties and the message content for the sensor
measurement have not yet been defined.</p>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text">HVAC/Temperature/Sensor.mi</span><a class="headerlink" href="#id20" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import all: from: (Smidgen, Smidgen.Data.Types)

file namespace: HVAC.Temperature.Sensor

Sensor.IO: Messaging.Interface
  extends: Stateful.IO
  ports:
<span class="hll">    Measurement:
</span><span class="hll">      output:
</span></pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id21">
<div class="code-block-caption"><span class="caption-text">HVAC/Temperature/Controller.mi</span><a class="headerlink" href="#id21" title="Permalink to this code">¶</a></div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>import all: from: (Smidgen, Smidgen.Data.Types)

file namespace: HVAC.Temperature.Controller

Controller.IO: Messaging.Interface
  extends: Stateful.IO
  ports:
<span class="hll">    Measurement:
</span><span class="hll">      input:
</span>    Enable:
      output:
    Disable:
      output:    
</pre></div>
</div>
</div>
</div>
<div class="section" id="refine-data-flow">
<h3>Refine Data Flow<a class="headerlink" href="#refine-data-flow" title="Permalink to this headline">¶</a></h3>
<p>The next step is to fully define the data content and format of each
message that is passed between software components in the application.
In this example, the only message with content is the sensor
measurement, which is defined as shown in the <a class="reference internal" href="#define-message-data-structures">bottom-up section</a>.  <code class="docutils literal notranslate"><span class="pre">HVAC/Temperature/Sensor.mi</span></code>
and <code class="docutils literal notranslate"><span class="pre">HVAC/Temperature/Controller.mi</span></code> should also be updated with a
matching <code class="docutils literal notranslate"><span class="pre">type</span></code> attribute, as shown <a class="reference internal" href="#define-component-messaging-interfaces">before</a>.</p>
</div>
<div class="section" id="define-configuration-properties">
<h3>Define Configuration Properties<a class="headerlink" href="#define-configuration-properties" title="Permalink to this headline">¶</a></h3>
<p>Before proceeding with the implementation, it is good to give some
consideration to what configuration properties may be required.  These
can be added to the component messaging interfaces, as shown
previously in the <a class="reference internal" href="#define-component-messaging-interfaces">bottom-up section</a>.</p>
</div>
<div class="section" id="declare-and-implement-primitive-components">
<h3>Declare and Implement Primitive Components<a class="headerlink" href="#declare-and-implement-primitive-components" title="Permalink to this headline">¶</a></h3>
<p>Coming soon…</p>
</div>
<div class="section" id="update-composite-component-definitions">
<h3>Update Composite Component Definitions<a class="headerlink" href="#update-composite-component-definitions" title="Permalink to this headline">¶</a></h3>
<p>More to come…</p>
</div>
<div class="section" id="final-steps">
<h3>Final Steps<a class="headerlink" href="#final-steps" title="Permalink to this headline">¶</a></h3>
<p>This should do it…</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../status.html" class="btn btn-neutral float-right" title="Status" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../vision.html" class="btn btn-neutral float-left" title="Vision" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2018, 2019, 2020 Jeffrey A. Webb

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    

  <style>
    /* Sidebar */
    .wy-nav-side {
      /*width:0px;*/
    }
    .wy-side-scroll {
      /*width:0px;*/
    }
    .wy-breadcrumbs {
      visibility: hidden;
    }
    /*
    [role=search] {
    visibility: hidden;
    }
    [role=navigation] {
    visibility: hidden;
    }
    */
    h1 {
    font-size:400%;
    }
  </style>


</body>
</html>