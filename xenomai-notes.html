<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Xenomai &mdash; Code Crafting Tools  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="RTEMS" href="rtems-notes.html" />
    <link rel="prev" title="Ubuntu" href="ubuntu-notes.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Code Crafting Tools
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="vision.html">Vision</a></li>
<li class="toctree-l1"><a class="reference internal" href="workflow/workflow.html">Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="status.html">Status</a></li>
<li class="toctree-l1"><a class="reference internal" href="philosophy.html">Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="guidelines.html">Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="considerations.html">Considerations</a></li>
<li class="toctree-l1"><a class="reference internal" href="software.html">Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="foundation.html">Foundation</a></li>
<li class="toctree-l1"><a class="reference internal" href="conventions.html">Conventions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="notes.html">Notes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="sphinx-notes.html">Sphinx</a></li>
<li class="toctree-l2"><a class="reference internal" href="lark-notes.html">Lark</a></li>
<li class="toctree-l2"><a class="reference internal" href="libavoid-notes.html">libavoid</a></li>
<li class="toctree-l2"><a class="reference internal" href="qt-notes.html">Qt 5</a></li>
<li class="toctree-l2"><a class="reference internal" href="virtualenvwrapper-notes.html">virtualenvwrapper</a></li>
<li class="toctree-l2"><a class="reference internal" href="python-notes.html">Python 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="ubuntu-notes.html">Ubuntu</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Xenomai</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#external-documentation">External Documentation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installation-notes">Installation Notes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ubuntu-18-04">Ubuntu 18.04</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rhel-8">RHEL 8</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#kernel-boot-parameters">Kernel Boot Parameters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="rtems-notes.html">RTEMS</a></li>
<li class="toctree-l2"><a class="reference internal" href="git-notes.html">Git</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Code Crafting Tools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="notes.html">Notes</a></li>
      <li class="breadcrumb-item active">Xenomai</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/xenomai-notes.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="xenomai">
<h1>Xenomai<a class="headerlink" href="#xenomai" title="Permalink to this heading"></a></h1>
<p><a class="reference internal" href="foundation.html#xenomai"><span class="std std-ref">Xenomai</span></a> is a free software project focused on building a
real-time framework for the <a class="reference internal" href="foundation.html#linux"><span class="std std-ref">Linux</span></a> platform.</p>
<section id="external-documentation">
<h2>External Documentation<a class="headerlink" href="#external-documentation" title="Permalink to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.xenomai.org">Xenomai Web Site</a></p></li>
<li><p><a class="reference external" href="https://gitlab.denx.de/Xenomai/xenomai/wikis/Building_Debian_Packages">Official Instructions for Building Xenomai Debian Packages</a></p></li>
</ul>
</section>
<section id="installation-notes">
<h2>Installation Notes<a class="headerlink" href="#installation-notes" title="Permalink to this heading"></a></h2>
<section id="ubuntu-18-04">
<h3>Ubuntu 18.04<a class="headerlink" href="#ubuntu-18-04" title="Permalink to this heading"></a></h3>
<p>Download xenomai-3.1.tar.bz2 from:</p>
<blockquote>
<div><p><a class="reference external" href="https://xenomai.org/downloads/xenomai/stable/">https://xenomai.org/downloads/xenomai/stable/</a></p>
</div></blockquote>
<p>and extract the archive:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">~/</span><span class="n">xeno</span><span class="o">-</span><span class="n">builds</span><span class="o">/</span><span class="mf">4.19.94</span><span class="o">-</span><span class="n">cip18</span><span class="o">-</span><span class="n">xenomai</span><span class="o">-</span><span class="mf">3.1</span>
<span class="n">cd</span>  <span class="o">~/</span><span class="n">xeno</span><span class="o">-</span><span class="n">builds</span><span class="o">/</span><span class="mf">4.19.94</span><span class="o">-</span><span class="n">cip18</span><span class="o">-</span><span class="n">xenomai</span><span class="o">-</span><span class="mf">3.1</span>
<span class="n">tar</span> <span class="o">-</span><span class="n">xvf</span> <span class="n">xenomai</span><span class="o">-</span><span class="mf">3.1</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">bz2</span>
</pre></div>
</div>
<p>Alternatively, check out the desired Xenomai version from git:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">~/</span><span class="n">xeno</span><span class="o">-</span><span class="n">builds</span><span class="o">/</span><span class="mf">4.19.94</span><span class="o">-</span><span class="n">cip18</span><span class="o">-</span><span class="n">xenomai</span><span class="o">-</span><span class="mf">3.1</span>
<span class="n">cd</span>  <span class="o">~/</span><span class="n">xeno</span><span class="o">-</span><span class="n">builds</span><span class="o">/</span><span class="mf">4.19.94</span><span class="o">-</span><span class="n">cip18</span><span class="o">-</span><span class="n">xenomai</span><span class="o">-</span><span class="mf">3.1</span>
<span class="n">GIT_SSL_NO_VERIFY</span><span class="o">=</span><span class="mi">1</span> <span class="n">git</span> <span class="n">clone</span> <span class="n">git</span><span class="p">:</span><span class="o">//</span><span class="n">git</span><span class="o">.</span><span class="n">xenomai</span><span class="o">.</span><span class="n">org</span><span class="o">/</span><span class="n">xenomai</span><span class="o">-</span><span class="mf">3.</span><span class="n">git</span>
<span class="n">cd</span> <span class="n">xenomai</span><span class="o">-</span><span class="mi">3</span>
<span class="n">git</span> <span class="n">checkout</span> <span class="n">stable</span><span class="o">/</span><span class="n">v3</span><span class="mf">.0</span><span class="o">.</span><span class="n">x</span>
</pre></div>
</div>
<p>Install the required packages for building the userspace library (once):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">devscripts</span> <span class="n">debhelper</span> <span class="n">dh</span><span class="o">-</span><span class="n">kpatches</span> <span class="n">findutils</span>
</pre></div>
</div>
<p>Build and install the Xenomai userspace library packages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">xeno</span><span class="o">-</span><span class="n">builds</span><span class="o">/</span><span class="mf">4.19.94</span><span class="o">-</span><span class="n">cip18</span><span class="o">-</span><span class="n">xenomai</span><span class="o">-</span><span class="mf">3.1</span><span class="o">/</span><span class="n">xenomai</span><span class="o">-</span><span class="mf">3.1</span>
<span class="n">DEBEMAIL</span><span class="o">=</span><span class="s2">&quot;your@email&quot;</span> <span class="n">DEBFULLNAME</span><span class="o">=</span><span class="s2">&quot;Your Name&quot;</span> <span class="n">debchange</span> <span class="o">-</span><span class="n">v</span> <span class="mf">3.1</span> <span class="n">Release</span> <span class="mf">3.1</span>
<span class="n">debuild</span> <span class="o">-</span><span class="n">uc</span> <span class="o">-</span><span class="n">us</span>
<span class="n">cd</span> <span class="o">..</span>
<span class="n">sudo</span> <span class="n">dpkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">libxenomai</span><span class="o">-</span><span class="n">dev_3</span><span class="mf">.1</span><span class="n">_amd64</span><span class="o">.</span><span class="n">deb</span>  \
             <span class="n">libxenomai1_3</span><span class="mf">.1</span><span class="n">_amd64</span><span class="o">.</span><span class="n">deb</span>  \
             <span class="n">xenomai</span><span class="o">-</span><span class="n">kernel</span><span class="o">-</span><span class="n">source_3</span><span class="mf">.1</span><span class="n">_all</span><span class="o">.</span><span class="n">deb</span>  \
             <span class="n">xenomai</span><span class="o">-</span><span class="n">runtime_3</span><span class="mf">.1</span><span class="n">_amd64</span><span class="o">.</span><span class="n">deb</span>
</pre></div>
</div>
<p>Install the required packages for building the kernel (once):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">kernel</span><span class="o">-</span><span class="n">package</span> <span class="n">libncurses</span><span class="o">-</span><span class="n">dev</span> <span class="n">fakeroot</span> <span class="n">zlib1g</span><span class="o">-</span><span class="n">dev</span> <span class="n">bison</span> <span class="n">flex</span> <span class="n">libssl</span><span class="o">-</span><span class="n">dev</span>
</pre></div>
</div>
<p>Download the CIP long-term support kernel from:</p>
<blockquote>
<div><p><a class="reference external" href="https://git.kernel.org/pub/scm/linux/kernel/git/cip/linux-cip.git/tag/?h=v4.19.94-cip18">https://git.kernel.org/pub/scm/linux/kernel/git/cip/linux-cip.git/tag/?h=v4.19.94-cip18</a></p>
</div></blockquote>
<p>and extract the archive:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tar</span> <span class="o">-</span><span class="n">xvf</span> <span class="n">linux</span><span class="o">-</span><span class="n">cip</span><span class="o">-</span><span class="mf">4.19.94</span><span class="o">-</span><span class="n">cip18</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">gz</span>
</pre></div>
</div>
<p>Alternatively, download the linux kernel source from the mainline tree:</p>
<blockquote>
<div><p><a class="reference external" href="https://mirrors.edge.kernel.org/pub/linux/kernel/v4.x/linux-4.9.38.tar.xz">https://mirrors.edge.kernel.org/pub/linux/kernel/v4.x/linux-4.9.38.tar.xz</a></p>
</div></blockquote>
<p>and extract the archive:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tar</span> <span class="o">-</span><span class="n">xvf</span> <span class="n">linux</span><span class="o">-</span><span class="mf">4.19.84</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">xz</span>
</pre></div>
</div>
<p>Download a matching ipipe patch from here:</p>
<blockquote>
<div><p><a class="reference external" href="https://xenomai.org/downloads/ipipe/v4.x/x86/">https://xenomai.org/downloads/ipipe/v4.x/x86/</a>
(e.g. ipipe-core-4.19.94-cip18-x86-10.patch)</p>
</div></blockquote>
<p>Apply the ipipe patch and set up the Xenomai cobalt kernel support:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">linux</span><span class="o">-</span><span class="n">cip</span><span class="o">-</span><span class="mf">4.19.94</span><span class="o">-</span><span class="n">cip18</span>
<span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">xenomai</span><span class="o">-</span><span class="n">kernel</span><span class="o">-</span><span class="n">source</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">prepare</span><span class="o">-</span><span class="n">kernel</span><span class="o">.</span><span class="n">sh</span> \
  <span class="o">--</span><span class="n">arch</span><span class="o">=</span><span class="n">x86</span> <span class="o">--</span><span class="n">linux</span><span class="o">=.</span> <span class="o">--</span><span class="n">adeos</span><span class="o">=../</span><span class="n">ipipe</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="mf">4.19.94</span><span class="o">-</span><span class="n">cip18</span><span class="o">-</span><span class="n">x86</span><span class="o">-</span><span class="mf">10.</span><span class="n">patch</span> \
  <span class="o">--</span><span class="n">outpatch</span><span class="o">=../</span><span class="n">xenomai</span><span class="o">-</span><span class="n">kernel</span><span class="o">.</span><span class="n">patch</span>
<span class="n">patch</span> <span class="o">-</span><span class="n">p1</span> <span class="o">&lt;</span> <span class="o">../</span><span class="n">xenomai</span><span class="o">-</span><span class="n">kernel</span><span class="o">.</span><span class="n">patch</span>
<span class="n">cd</span> <span class="o">..</span>
</pre></div>
</div>
<p>Start with the kernel configuration from the standard Ubuntu kernel:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">linux</span><span class="o">-</span><span class="n">cip</span><span class="o">-</span><span class="mf">4.19.94</span><span class="o">-</span><span class="n">cip18</span>
<span class="n">cp</span> <span class="o">/</span><span class="n">boot</span><span class="o">/</span><span class="n">config</span><span class="o">-</span><span class="mf">4.15.0</span><span class="o">-</span><span class="mi">70</span><span class="o">-</span><span class="n">generic</span> <span class="o">.</span><span class="n">config</span>
<span class="n">make</span> <span class="n">olddefconfig</span>
<span class="n">make</span> <span class="n">menuconfig</span>
</pre></div>
</div>
<p>Note that if you import the config from a previously built
xenomai/ipipe-patched kernel instead of the “standard” Ubuntu kernel config
mentioned above, the configuration options below should already be selected.</p>
<p>Adjust the following kernel configuration options:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>4.4.199-cip39, 4.19.94-cip18 Config

 General Setup
   Local version: -xenomai-3.1
 Processor type and features
   Multi-core scheduler support
     CPU core priorities scheduler support -&gt; [n] (on newer kernels)
 Memory Management Options (or Processor type and features on older kernels)
   Transparent Hugepage Support -&gt; [n]
   Allow for memory compaction -&gt; [n]
   Contiguous Memory Allocator -&gt; [n]
   Page migration -&gt; [n]
 Power management and ACPI options
   CPU Frequency scaling
     CPU Frequency scaling -&gt; [n]
   ACPI Support
     Processor -&gt; [n]
   CPU Idle
     CPU idle PM support -&gt; [n]
 Device Drivers
   Input device support
     Miscellaneous devices
       PC Speaker support -&gt; [n]
   Character devices
     Serial Drivers
       8250/16550 and compatible serial support -&gt; [m]
   Microsoft Hyper-V guest support -&gt; [n]
   Staging drivers -&gt; [n]
 Kernel hacking
   KGDB -&gt; [n]
 Xenomai/cobalt
   Core features
     Shared interrupts -&gt; [y]
   Drivers
     Serial Drivers
       16550A UART driver -&gt; [m]
         Hardware access mode
           Any access mode -&gt; [y]
       PCI board support -&gt; [y]
     RTnet
       RTnet, TCP/IP socket interface -&gt; [m]
         Protocol Stack
           Real-Time IPv4
             TCP support -&gt; [m]
           RTmac Layer
             NoMAC discipline for RTmac -&gt; [m]
       Drivers
         New Intel(R) PRO/1000 (Gigabit) -&gt; [m]
       Add-Ons
         Real-Time Capturing Support -&gt; [m]
         IP protocol proxy for Linux -&gt; [m]
           Enable ARP handling via protocol proxy -&gt; [y]
     Real-time IPC drivers
       RTIPC protocol family -&gt; [y]
     UDD support
       User-space device driver framework -&gt; [m]
</pre></div>
</div>
<p>Save the kernel configuration to <code class="docutils literal notranslate"><span class="pre">.config</span></code> and exit the configuration tool.</p>
<p>Build the debian (Ubuntu) kernel packages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>time make -j `getconf _NPROCESSORS_ONLN` deb-pkg
</pre></div>
</div>
<p>Install the kernel packages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">..</span>
<span class="n">sudo</span> <span class="n">dpkg</span> <span class="o">-</span><span class="n">i</span> <span class="n">linux</span><span class="o">-</span><span class="n">image</span><span class="o">-</span><span class="mf">4.19.94</span><span class="o">-</span><span class="n">cip18</span><span class="o">-</span><span class="n">xenomai</span><span class="o">-</span><span class="mf">3.1_4.19.94</span><span class="o">-</span><span class="n">cip18</span><span class="o">-</span><span class="n">xenomai</span><span class="o">-</span><span class="mf">3.1</span><span class="o">-</span><span class="mi">1</span><span class="n">_amd64</span><span class="o">.</span><span class="n">deb</span> <span class="n">linux</span><span class="o">-</span><span class="n">headers</span><span class="o">-</span><span class="mf">4.19.94</span><span class="o">-</span><span class="n">cip18</span><span class="o">-</span><span class="n">xenomai</span><span class="o">-</span><span class="mf">3.1_4.19.94</span><span class="o">-</span><span class="n">cip18</span><span class="o">-</span><span class="n">xenomai</span><span class="o">-</span><span class="mf">3.1</span><span class="o">-</span><span class="mi">1</span><span class="n">_amd64</span><span class="o">.</span><span class="n">deb</span>
</pre></div>
</div>
</section>
<section id="rhel-8">
<h3>RHEL 8<a class="headerlink" href="#rhel-8" title="Permalink to this heading"></a></h3>
<p>First of all, make sure that you are set up to <a class="reference external" href="https://stackoverflow.com/questions/15055841/how-to-create-spec-file-rpm">build RPM packages</a> by creating a few required directories:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">~/</span><span class="n">rpmbuild</span><span class="o">/</span><span class="n">BUILD</span>
<span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">~/</span><span class="n">rpmbuild</span><span class="o">/</span><span class="n">BUILDROOT</span>
<span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">~/</span><span class="n">rpmbuild</span><span class="o">/</span><span class="n">RPMS</span>
<span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">~/</span><span class="n">rpmbuild</span><span class="o">/</span><span class="n">SOURCES</span>
<span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">~/</span><span class="n">rpmbuild</span><span class="o">/</span><span class="n">SPECS</span>
<span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">~/</span><span class="n">rpmbuild</span><span class="o">/</span><span class="n">SRPMCS</span>
<span class="n">mkdir</span> <span class="o">-</span><span class="n">p</span> <span class="o">~/</span><span class="n">rpmbuild</span><span class="o">/</span><span class="n">tmp</span>
</pre></div>
</div>
<p>and an <code class="docutils literal notranslate"><span class="pre">~/.rpmmacros</span></code> file containing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">packager</span> <span class="n">Firstname</span> <span class="n">Lastname</span>
<span class="o">%</span><span class="n">_topdir</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">username</span><span class="o">/</span><span class="n">rpmbuild</span>
<span class="o">%</span><span class="n">_tmppath</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">username</span><span class="o">/</span><span class="n">rpmbuild</span><span class="o">/</span><span class="n">tmp</span>
</pre></div>
</div>
<p>Now create a file named <code class="docutils literal notranslate"><span class="pre">xenomai3.spec</span></code> in <code class="docutils literal notranslate"><span class="pre">~/rpmbuild/SPECS/</span></code>
containing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>%define _unpackaged_files_terminate_build 0

Summary: Xenomai real-time system
Name: xenomai
Version: 3.1.3
Release: 1
License: GNU GPL
Group: Development/Tools
Source: xenomai-3.1.3.tar.gz
URL: http://www.xenomai.org
Buildroot: %{_tmppath}/%{name}-%{version}-root

%description
Xenomai user-space installation.  Requires a Xenomai patched kernel.

%prep
%setup -q

%build
./scripts/bootstrap
./configure --prefix=/usr --sysconfdir=/etc --includedir=/usr/include/xenomai
make -j8

%install
[ &quot;$RPM_BUILD_ROOT&quot; != &quot;/&quot; ] &amp;&amp; rm -rf $RPM_BUILD_ROOT
make DESTDIR=$RPM_BUILD_ROOT install

%clean
[ &quot;${RPM_BUILD_ROOT}&quot; != &quot;/&quot; ] &amp;&amp; rm -rf ${RPM_BUILD_ROOT}

%post
if ! getent group xenomai &gt;/dev/null; then
    groupadd --system xenomai || true
fi
grubby --update-kernel=/boot/vmlinuz-$(uname -r) --args=\&quot;xenomai.allowed_group=$(getent group xenomai | cut --delimiter &#39;:&#39; --fields 3)\&quot;

%files
%defattr(-,root, root)
%dir /usr/include/xenomai
%dir /usr/lib/xenomai
/usr/bin/*
/usr/demo/*
/usr/include/xenomai/*
/usr/lib/cobalt.wrappers
/usr/lib/dynlist.ld
/usr/lib/lib*
/usr/lib/modechk.wrappers
/usr/lib/xenomai/*
/usr/sbin/*
/etc/udev/rules.d/00-rtnet.rules
/etc/udev/rules.d/rtdm.rules
/etc/rtnet.conf
/etc/tdma.conf
</pre></div>
</div>
<p>and download the associated source tarball (e.g. <code class="docutils literal notranslate"><span class="pre">xenomai-3.1.3.tar.gz</span></code>)
from <a class="reference external" href="https://xenomai.org/downloads/xenomai/stable/">https://xenomai.org/downloads/xenomai/stable/</a> into
<code class="docutils literal notranslate"><span class="pre">~/rpmbuild/SOURCES</span></code>.</p>
<p>Now you should be able to build an RPM file containing the Xenomai user-space
support like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">rpmbuild</span> <span class="o">-</span><span class="n">ba</span> <span class="o">~/</span><span class="n">rpmbuild</span><span class="o">/</span><span class="n">SPECS</span><span class="o">/</span><span class="n">xenomai3</span><span class="o">.</span><span class="n">spec</span>
</pre></div>
</div>
<p>If all goes well, an RPM file will be generated in <code class="docutils literal notranslate"><span class="pre">~/rpmbuild/RPMS</span></code> that
can be installed like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">rpm</span> <span class="o">-</span><span class="n">i</span> <span class="n">RPMS</span><span class="o">/</span><span class="n">x86_64</span><span class="o">/</span><span class="n">xenomai</span><span class="o">-</span><span class="mf">3.1.3</span><span class="o">-</span><span class="mf">1.</span><span class="n">x86_64</span><span class="o">.</span><span class="n">rpm</span>
</pre></div>
</div>
<p>Building a Linux kernel with Xenomai support on RHEL 8 is very similar to the
process outlined above for Ubuntu 18.04, so most of those instructions are
applicable here.</p>
<p>The kernel config file from Ubuntu 18.04
(i.e. <code class="docutils literal notranslate"><span class="pre">/boot/config-4.15.0-70-generic</span></code>) should also be a suitable starting
point for building a kernel under RHEL 8.  If you want to use the kernel
config file from RHEL 8 instead
(i.e. <code class="docutils literal notranslate"><span class="pre">/boot/config-4.18.0-425.3.1.el8.x86_64</span></code>), you may need to disable
guest OS support (in menuconfig) to eliminate some warnings about PARAVIRT
dependencies when running the “make olddefconfig” command.</p>
<p>You will also want to build an RPM package instead of a Debian/Ubuntu
package, so the <code class="docutils literal notranslate"><span class="pre">make</span></code> command will look like this instead:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>time make -j `getconf _NPROCESSORS_ONLN` binrpm-pkg
</pre></div>
</div>
<p>If all goes well, this command will generate an RPM package for the new
kernel under <code class="docutils literal notranslate"><span class="pre">~/rpmbuild/RPMS</span></code> that can be installed using <code class="docutils literal notranslate"><span class="pre">rpm</span> <span class="pre">-i</span></code>.</p>
<p>If you have trouble building RPMs, you can build and install everything
manually (instead of from RPM packages), but uninstalling may get messy:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span> <span class="o">-</span><span class="n">j</span> <span class="mi">8</span>
<span class="n">sudo</span> <span class="n">make</span> <span class="n">modules_install</span> <span class="o">-</span><span class="n">j</span> <span class="mi">8</span>
<span class="n">sudo</span> <span class="n">make</span> <span class="n">install</span> <span class="o">-</span><span class="n">j</span> <span class="mi">8</span>
<span class="n">sudo</span> <span class="n">update</span><span class="o">-</span><span class="n">grub</span>
</pre></div>
</div>
</section>
</section>
<section id="kernel-boot-parameters">
<h2>Kernel Boot Parameters<a class="headerlink" href="#kernel-boot-parameters" title="Permalink to this heading"></a></h2>
<p>The following kernel boot parameters may (or may not) be useful:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">drm_kms_helper</span><span class="o">.</span><span class="n">poll</span><span class="o">=</span><span class="mi">0</span>
<span class="n">nouveau</span><span class="o">.</span><span class="n">noaccel</span><span class="o">=</span><span class="mi">1</span>
<span class="n">pci</span><span class="o">=</span><span class="n">routeirq</span>
<span class="n">xenomai</span><span class="o">.</span><span class="n">allowed_group</span><span class="o">=</span><span class="mi">997</span>
<span class="n">acpi_irq_nobalance</span>
<span class="n">noirqbalance</span>
<span class="n">nmi_watchdog</span><span class="o">=</span><span class="mi">0</span>
<span class="n">nosoftlockup</span>
<span class="n">nosmap</span>
<span class="n">nohalt</span>
<span class="n">mce</span><span class="o">=</span><span class="n">ignore_ce</span>
<span class="n">idle</span><span class="o">=</span><span class="n">poll</span>
<span class="n">intel_idle</span><span class="o">.</span><span class="n">max_cstate</span><span class="o">=</span><span class="mi">0</span>
<span class="n">processor</span><span class="o">.</span><span class="n">max_cstate</span><span class="o">=</span><span class="mi">0</span>
<span class="n">intel</span><span class="o">.</span><span class="n">max_cstate</span><span class="o">=</span><span class="mi">0</span>
<span class="n">processor_idle</span><span class="o">.</span><span class="n">max_cstate</span><span class="o">=</span><span class="mi">0</span>
</pre></div>
</div>
<p>Note that kernel boot parameters can be set by adding them to the
<code class="docutils literal notranslate"><span class="pre">GRUB_CMDLINE_LINUX_DEFAULT</span></code> string in <code class="docutils literal notranslate"><span class="pre">/etc/default/grub</span></code> and then
running <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">update-grub</span></code>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="ubuntu-notes.html" class="btn btn-neutral float-left" title="Ubuntu" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="rtems-notes.html" class="btn btn-neutral float-right" title="RTEMS" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018, 2019, 2020, 2021, 2022, 2023 Jeffrey A. Webb.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar */
    .wy-nav-side {
      /*width:0px;*/
    }
    .wy-side-scroll {
      /*width:0px;*/
    }
    .wy-breadcrumbs {
      visibility: hidden;
    }
    /*
    [role=search] {
    visibility: hidden;
    }
    [role=navigation] {
    visibility: hidden;
    }
    */
    h1 {
    font-size:400%;
    }
  </style>


</body>
</html>